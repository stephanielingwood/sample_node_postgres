language: node_js

node_js: "0.10.36"

# build_image:
#   name: shippable/minv2
#   net: host
#   privileged: true

before_install:
  - node --version
  - npm install npm@2.3.0 -g
  - npm --version
  - npm cache clean

cache: true

services:
  - redis

addons:
  postgresql: "9.2"
  firefox: "21.0"

env:
  global:
    - DATABASE_URL=postgres://postgres:@localhost:5432/app_test
    - DATABASE_DIALECT=postgres

before_script:
  - psql -c 'CREATE DATABASE app_test;' -U postgres
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - firefox -v
  - echo $SHIPPABLE_POSTGRES_VERSION
  - psql -c \des+
  - psql --version
  - which dropdb && dropdb -e --if-exists app_test
  - psql -c 'CREATE DATABASE app_test;' -U postgres

script:
  - npm test

after_script:
  - echo 'after script'
